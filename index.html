<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Dash | Terminal Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ical.js/1.5.0/ical.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=JetBrains+Mono:wght@400;800&family=Orbitron:wght@400;800&display=swap');
        [x-cloak] { display: none !important; }
        
        :root { --accent-glow: #3b82f6; --glow-strength: 20px; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #020617; color: #f8fafc; overflow-x: hidden; margin: 0; }
        
        .bg-animate { background: radial-gradient(circle at 50% 50%, #1e1b4b 0%, #020617 100%); position: fixed; inset: 0; z-index: -1; }
        .bg-overlay { position: fixed; inset: 0; z-index: -1; background-size: cover; background-position: center; transition: background-image 0.8s ease, filter 0.3s ease; }
        
        .nexus-card { 
            background: rgba(15, 23, 42, 0.65); 
            backdrop-filter: blur(25px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            border-radius: 1.5rem; 
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.7);
        }
        
        .icon-box { 
            display: flex; align-items: center; justify-content: center; 
            border-radius: 1.2rem; background: rgba(255,255,255,0.04); 
            border: 1px solid rgba(255,255,255,0.08);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; position: relative; 
        }
        .icon-box img { width: 55%; height: 55%; object-fit: contain; pointer-events: none; }
        .icon-box:hover { 
            transform: translateY(-8px) scale(1.05); 
            background: rgba(255,255,255,0.1); 
            box-shadow: 0 0 var(--glow-strength) -2px var(--accent-glow); 
            border-color: var(--accent-glow); 
        }
        
        .font-digital-dash { font-family: 'Orbitron', sans-serif; letter-spacing: -2px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body x-data="nexusHandler" x-cloak :style="`--accent-glow: ${state.settings.accentColor}; --glow-strength: ${state.settings.hoverGlow}px;`" @click="closeContextMenu()">

    <div class="bg-animate"></div>
    <div class="bg-overlay" :style="initialized ? { backgroundImage: `linear-gradient(rgba(0,0,0,${state.settings.darken / 100}), rgba(0,0,0,${state.settings.darken / 100})), url(${state.settings.bg})`, filter: `blur(${state.settings.blur}px)` } : {}"></div>

    <div class="relative z-10 min-h-screen flex flex-col" x-show="initialized">
        <header class="p-6 flex justify-between items-center max-w-[1800px] mx-auto w-full">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-2xl flex items-center justify-center bg-blue-600 border-b-2 border-black/40" :style="`background-color: ${state.settings.accentColor}`">
                    <svg class="animate-pulse w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5"><circle cx="12" cy="12" r="3"/><path d="M12 2v2M12 20v2M1 12h2M21 12h2"/></svg>
                </div>
                <h1 class="font-extrabold text-2xl tracking-tighter uppercase" x-text="state.settings.dashName"></h1>
            </div>
            <button @click="settingsOpen = true" class="w-12 h-12 bg-white/5 border border-white/10 rounded-2xl flex items-center justify-center hover:bg-white/10">
                ⚙️
            </button>
        </header>

        <main class="flex-grow flex flex-col px-6">
            <section class="py-8 text-center">
                <h2 x-text="time" 
                    :class="state.settings.clockFont"
                    :style="`color: ${state.settings.clockColor};`"
                    class="text-[7rem] md:text-[8rem] font-black tracking-tighter leading-none">00:00</h2>
                <div class="w-full max-w-2xl mx-auto mt-6">
                    <form action="https://google.com/search" method="GET">
                        <input type="text" name="q" placeholder="Neural Search..." 
                               class="w-full bg-slate-950/40 border-2 border-white/5 rounded-full py-5 px-10 text-xl text-center focus:outline-none focus:border-blue-500 transition-all">
                    </form>
                </div>
            </section>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 max-w-[1800px] mx-auto w-full pb-12">
                <aside class="lg:col-span-3 flex flex-col gap-8 hidden lg:flex">
                    <div class="nexus-card p-6 text-center">
                        <h4 class="text-[10px] font-black uppercase tracking-widest opacity-40 mb-2">Syncing Atmospheric...</h4>
                        <div x-show="weather.temp !== null">
                            <span class="text-5xl font-black" x-text="weather.temp + '°F'"></span>
                        </div>
                    </div>
                    <div class="nexus-card p-6">
                        <h4 class="text-[10px] font-black uppercase opacity-40 mb-4">Live News</h4>
                        <div class="space-y-4">
                            <template x-for="item in news" :key="item.title">
                                <a :href="item.link" target="_blank" class="block text-sm font-bold text-white/70 hover:text-white transition-all" x-text="item.title"></a>
                            </template>
                        </div>
                    </div>
                </aside>

                <main class="lg:col-span-6">
                    <div class="nexus-card p-8 min-h-[500px]">
                        <div class="flex gap-6 mb-8 border-b border-white/5">
                            <template x-for="p in state.settings.pages" :key="p.id">
                                <button @click="activeTab = p.id" :class="activeTab === p.id ? 'border-b-2 pb-4 text-blue-400 border-blue-400' : 'text-white/20 pb-4'" class="text-[10px] font-black uppercase tracking-widest" x-text="p.name"></button>
                            </template>
                        </div>
                        <div class="flex flex-wrap gap-6 justify-center">
                            <template x-for="(link, index) in getCurrentLinks()" :key="index">
                                <div class="flex flex-col items-center gap-2">
                                    <a :href="link.url" target="_blank" class="icon-box" :style="`width: ${state.settings.iconSize}px; height: ${state.settings.iconSize}px;`">
                                        <img :src="getIcon(link)" onerror="this.src='https://cdn.jsdelivr.net/gh/walkxcode/dashboard-icons/svg/default.svg'">
                                    </a>
                                    <span x-text="link.name" class="text-[10px] font-black uppercase opacity-40"></span>
                                </div>
                            </template>
                            <button @click="addModalOpen = true" class="icon-box border-dashed border-2 border-white/10" :style="`width: ${state.settings.iconSize}px; height: ${state.settings.iconSize}px;`">+</button>
                        </div>
                    </div>
                </main>

                <aside class="lg:col-span-3">
                    <div class="nexus-card p-6 min-h-[400px]">
                        <h4 class="text-[10px] font-black uppercase opacity-40 mb-6">Schedule Sync</h4>
                        <div class="space-y-4">
                            <template x-for="ev in events" :key="ev.ts">
                                <div class="border-l-2 border-blue-500 pl-4 py-1">
                                    <p x-text="ev.title" class="text-xs font-bold"></p>
                                    <p x-text="ev.relativeTime" class="text-[9px] opacity-30 font-bold uppercase"></p>
                                </div>
                            </template>
                        </div>
                    </div>
                </aside>
            </div>
        </main>
    </div>

    <div x-show="settingsOpen" class="fixed inset-0 z-[100] flex items-center justify-center p-4 backdrop-blur-md">
        <div class="absolute inset-0 bg-black/80" @click="settingsOpen = false"></div>
        <div class="nexus-card w-full max-w-xl relative z-10 p-10">
            <h2 class="text-2xl font-black mb-6">UI Configuration</h2>
            <div class="space-y-6">
                <div><label class="text-xs uppercase opacity-50">Accent Color</label><input type="color" x-model="state.settings.accentColor" @input="persist()" class="w-full bg-transparent"></div>
                <div><label class="text-xs uppercase opacity-50">Icon Size</label><input type="range" min="40" max="150" x-model="state.settings.iconSize" @input="persist()"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('nexusHandler', () => ({
                initialized: false,
                settingsOpen: false,
                addModalOpen: false,
                time: '00:00:00',
                activeTab: 'links',
                events: [],
                news: [],
                weather: { temp: null },
                
                state: {
                    linkData: { 'links': [], 'server': [], 'work': [] },
                    settings: { 
                        dashName: 'Nexus-Dash', accentColor: '#3b82f6', 
                        bg: 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&q=80&w=1600', 
                        darken: 50, blur: 0, iconSize: 85, hoverGlow: 30,
                        clockFont: 'font-sans-dash', clockColor: '#ffffff',
                        pages: [{id: 'links', name: 'Home'}, {id: 'server', name: 'Server'}, {id: 'work', name: 'Work'}]
                    }
                },

                init() {
                    const saved = localStorage.getItem('NEXUS_PROTOCOL_FINAL_V1');
                    if (saved) this.state = JSON.parse(saved);
                    
                    this.updateTime();
                    setInterval(() => this.updateTime(), 1000);
                    
                    this.refreshAll();
                    this.initialized = true;
                },

                updateTime() {
                    this.time = new Date().toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });
                },

                refreshAll() {
                    this.fetchNews();
                    this.fetchEvents();
                },

                async fetchEvents() {
                    try {
                        const response = await fetch(`https://call.sndjy.us?t=${Date.now()}`);
                        const calendarData = await response.json();
                        let upcoming = [];
                        
                        calendarData.forEach(cal => {
                            if (!cal.success) return;
                            const comp = new ICAL.Component(ICAL.parse(cal.data));
                            comp.getAllSubcomponents('vevent').forEach(vevent => {
                                const event = new ICAL.Event(vevent);
                                const start = event.startDate.toJSDate();
                                if (start >= new Date()) {
                                    upcoming.push({ title: event.summary, ts: start.getTime(), relativeTime: start.toDateString() });
                                }
                            });
                        });
                        this.events = upcoming.sort((a,b) => a.ts - b.ts).slice(0, 5);
                    } catch (e) { console.error('Schedule Error'); }
                },

                async fetchNews() {
                    try {
                        const res = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Ffeeds.foxnews.com%2Ffoxnews%2Flatest');
                        const data = await res.json();
                        this.news = (data.items || []).slice(0, 5);
                    } catch (e) {}
                },

                persist() { localStorage.setItem('NEXUS_PROTOCOL_FINAL_V1', JSON.stringify(this.state)); },
                getCurrentLinks() { return this.state.linkData[this.activeTab] || []; },
                getIcon(link) {
                    return `https://cdn.jsdelivr.net/gh/walkxcode/dashboard-icons/svg/${(link.icon || 'default').toLowerCase()}.svg`;
                }
            }));
        });
    </script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</body>
</html>
