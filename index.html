<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nexus Dash | Full Edition</title>
    <style>
        :root {
            --bg-bright: 100%;
            --icon-size: 60px;
            --text-opacity: 1;
            --accent-color: #58a6ff;
        }
        body {
            background-color: #0d1117;
            filter: brightness(var(--bg-bright));
            color: rgba(201, 209, 217, var(--text-opacity));
            font-family: -apple-system, system-ui, sans-serif;
            margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }
        /* Settings Panel */
        #settings-panel {
            position: fixed; right: -300px; top: 0; width: 260px; height: 100%;
            background: #161b22; border-left: 1px solid #30363d; padding: 20px;
            transition: 0.3s; z-index: 100; box-shadow: -5px 0 15px rgba(0,0,0,0.5);
        }
        #settings-panel.open { right: 0; }
        .control-group { margin-bottom: 20px; }
        .control-group label { display: block; font-size: 12px; margin-bottom: 8px; color: #8b949e; }
        input[type="range"] { width: 100%; }

        /* Layout */
        #header { text-align: center; padding: 40px 20px; }
        #clock { font-size: 4.5rem; font-weight: bold; margin: 0; color: var(--accent-color); }
        .container { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; width: 90%; max-width: 1100px; }
        .card { background: #161b22; border: 1px solid #30363d; border-radius: 12px; padding: 20px; }
        .card h2 { margin-top: 0; font-size: 1.2rem; border-bottom: 1px solid #30363d; padding-bottom: 10px; }

        /* Icons */
        .icon-grid { display: flex; gap: 15px; flex-wrap: wrap; }
        .icon-link {
            width: var(--icon-size); height: var(--icon-size);
            background: #21262d; border-radius: 12px; display: flex;
            align-items: center; justify-content: center; text-decoration: none;
            color: white; font-weight: bold; font-size: 1.2rem; transition: transform 0.2s;
        }
        .icon-link:hover { transform: scale(1.05); background: #30363d; }

        /* Schedule */
        #schedule-list { list-style: none; padding: 0; margin: 0; }
        #schedule-list li { padding: 8px 0; border-bottom: 1px solid #21262d; font-size: 0.9rem; }
        
        #toggle-settings { position: fixed; top: 15px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; z-index: 101; }
    </style>
</head>
<body>

    <button id="toggle-settings">⚙️</button>

    <div id="settings-panel">
        <h3>Settings</h3>
        <div class="control-group">
            <label>NexusKey (Persistence)</label>
            <input type="text" id="nexuskey-input" placeholder="Enter key...">
        </div>
        <div class="control-group">
            <label>Brightness</label>
            <input type="range" id="bright-slider" min="20" max="100" value="100">
        </div>
        <div class="control-group">
            <label>Icon Size</label>
            <input type="range" id="size-slider" min="40" max="150" value="60">
        </div>
        <div class="control-group">
            <label>Text Opacity</label>
            <input type="range" id="opacity-slider" min="10" max="100" value="100">
        </div>
        <button onclick="saveSettings()" style="width:100%; padding:10px; background: var(--accent-color); color: white; border: none; border-radius: 5px; cursor: pointer;">Save Settings</button>
    </div>

    <div id="header">
        <div id="clock">00:00</div>
        <p>User: Joey | Key: <span id="current-key">Default</span></p>
    </div>

    <div class="container">
        <div class="card">
            <h2>Quick Links</h2>
            <div class="icon-grid">
                <a href="https://yuno.sndjy.us" class="icon-link">Y</a>
                <a href="https://portainer.sndjy.us" class="icon-link">P</a>
                <a href="https://homeassistant.local:8123" class="icon-link">H</a>
                <a href="https://call.sndjy.us" class="icon-link">C</a>
            </div>
        </div>

        <div class="card">
            <h2>Master Schedule</h2>
            <ul id="schedule-list">
                <li>Syncing events...</li>
            </ul>
        </div>
    </div>

    <script>
        const bSlider = document.getElementById('bright-slider');
        const sSlider = document.getElementById('size-slider');
        const oSlider = document.getElementById('opacity-slider');
        const nInput = document.getElementById('nexuskey-input');

        // Toggle Settings
        document.getElementById('toggle-settings').onclick = () => document.getElementById('settings-panel').classList.toggle('open');

        // Live Preview (No Refresh)
        bSlider.oninput = () => document.documentElement.style.setProperty('--bg-bright', bSlider.value + '%');
        sSlider.oninput = () => document.documentElement.style.setProperty('--icon-size', sSlider.value + 'px');
        oSlider.oninput = () => document.documentElement.style.setProperty('--text-opacity', oSlider.value / 100);

        async function fetchSchedule() {
            const key = nInput.value || 'default';
            try {
                const response = await fetch(`https://api.cal.sndjy.us/events?key=${key}&t=${Date.now()}`);
                const data = await response.json();
                const list = document.getElementById('schedule-list');
                list.innerHTML = data.events.length 
                    ? data.events.map(e => `<li><strong>${e.time}</strong>: ${e.title}</li>`).join('')
                    : '<li>No events found for today.</li>';
            } catch (err) {
                document.getElementById('schedule-list').innerHTML = '<li>Error loading schedule.</li>';
            }
        }

        function saveSettings() {
            const settings = {
                nexuskey: nInput.value,
                brightness: bSlider.value,
                iconSize: sSlider.value,
                opacity: oSlider.value
            };
            localStorage.setItem('nexusSettings', JSON.stringify(settings));
            document.getElementById('current-key').innerText = nInput.value || "Default";
            fetchSchedule(); // Refresh schedule with new key
        }

        function loadSettings() {
            const saved = JSON.parse(localStorage.getItem('nexusSettings'));
            if (saved) {
                nInput.value = saved.nexuskey || "";
                document.getElementById('current-key').innerText = saved.nexuskey || "Default";
                bSlider.value = saved.brightness;
                sSlider.value = saved.iconSize;
                oSlider.value = saved.opacity;

                document.documentElement.style.setProperty('--bg-bright', saved.brightness + '%');
                document.documentElement.style.setProperty('--icon-size', saved.iconSize + 'px');
                document.documentElement.style.setProperty('--text-opacity', saved.opacity / 100);
            }
            fetchSchedule();
        }

        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }, 1000);

        loadSettings();
    </script>
</body>
</html>
